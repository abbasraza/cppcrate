<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <title>How To Use CppCrate</title>
    <link href="extra.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <div id="projectname">CppCrate&#160;<span id="projectnumber">0.1</span></div>
</div>
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">How To Use <a class="el" href="namespaceCppCrate.html" title="Encapsulates all classes of the CppCrate library. ">CppCrate</a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The following small code examples illustrate how to use CppCrate. Feel free to contact the documentation of the used classes to get more information.</p>
<dl class="section warning"><dt>Warning</dt><dd>For real code do not forget to add proper error handling. You have been warned ðŸ˜‰</dd></dl>
<h1><a class="anchor" id="cce_con"></a>
Connection</h1>
<h2><a class="anchor" id="cce_con_simple"></a>
Simple connection</h2>
<div class="fragment"><div class="line"><a class="code" href="classCppCrate_1_1Client.html" title="Provides the main interface for accessing to Crate. ">CppCrate::Client</a> client;</div><div class="line"><span class="keywordflow">if</span> (client.<a class="code" href="classCppCrate_1_1Client.html#a97f0f1c81de20027bc0f1d3605fab653">connect</a>(<span class="stringliteral">&quot;http://localhost:4200&quot;</span>)) { ... }</div></div><!-- fragment --><p>or</p>
<div class="fragment"><div class="line"><a class="code" href="classCppCrate_1_1Client.html" title="Provides the main interface for accessing to Crate. ">CppCrate::Client</a> client;</div><div class="line">client.<a class="code" href="classCppCrate_1_1Client.html#a97f0f1c81de20027bc0f1d3605fab653">connect</a>(<span class="stringliteral">&quot;http://localhost:4200&quot;</span>);</div><div class="line"><span class="keywordflow">if</span> (client.<a class="code" href="classCppCrate_1_1Client.html#a4a92947364d0d7f10e4c197caca05990">isConnected</a>()) { ... }</div></div><!-- fragment --><h2><a class="anchor" id="cce_con_multi"></a>
Connect to a cluster and use all cluster nodes as fall-back</h2>
<div class="fragment"><div class="line"><span class="comment">// 1. Connect to the preferred node of the cluster</span></div><div class="line"><a class="code" href="classCppCrate_1_1Node.html" title="Encapsulates the information needed to connect to a Crate cluster node. ">CppCrate::Node</a> preferredNode(<span class="stringliteral">&quot;http://localhost:4200&quot;</span>);</div><div class="line"><a class="code" href="classCppCrate_1_1Client.html" title="Provides the main interface for accessing to Crate. ">CppCrate::Client</a> client;</div><div class="line"><span class="keywordflow">if</span> (client.<a class="code" href="classCppCrate_1_1Client.html#a97f0f1c81de20027bc0f1d3605fab653">connect</a>(preferredNode)) {</div><div class="line">  <span class="comment">// 2. Get all nodes of the cluster</span></div><div class="line">  std::vector&lt;CppCrate::Node&gt; nodes = client.<a class="code" href="classCppCrate_1_1Client.html#a26830d36e5d670f5502e61563211debd">clusterNodes</a>();</div><div class="line">  <span class="keywordflow">if</span> (!nodes.empty()) {</div><div class="line">    <span class="comment">// 3. If cluster nodes could be fetched, put the preferred node at front (optional)</span></div><div class="line">    <span class="keyword">auto</span> it = std::find(nodes.begin(), nodes.end(), preferredNode);</div><div class="line">    <span class="keywordflow">if</span> (it != nodes.end()) {</div><div class="line">      std::iter_swap(nodes.begin(), it);</div><div class="line">    }</div><div class="line">    <span class="comment">// 4. Reconnect to &quot;all&quot; nodes.</span></div><div class="line">    client.<a class="code" href="classCppCrate_1_1Client.html#a97f0f1c81de20027bc0f1d3605fab653">connect</a>(nodes);</div><div class="line">  }</div><div class="line">}</div><div class="line"><span class="keywordflow">if</span> (client.<a class="code" href="classCppCrate_1_1Client.html#a4a92947364d0d7f10e4c197caca05990">isConnected</a>()) {</div><div class="line">  <span class="comment">// ...</span></div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="cce_sql"></a>
SQL Interface</h1>
<h2><a class="anchor" id="cce_sql-raw"></a>
Just give me JSON!</h2>
<div class="fragment"><div class="line"><a class="code" href="classCppCrate_1_1RawResult.html" title="Encapsulates Crate&#39;s HTTP endpoint reply. ">CppCrate::RawResult</a> result = client.<a class="code" href="classCppCrate_1_1Client.html#ac584f633296568452409a7217478f4d0">execRaw</a>(<span class="stringliteral">&quot;SELECT name, port[&#39;http&#39;] AS port FROM sys.nodes&quot;</span>);</div><div class="line"><span class="keywordflow">if</span> (result) {</div><div class="line">  std::cout &lt;&lt; result.<a class="code" href="classCppCrate_1_1RawResult.html#abdc216288e03fe6b681ebaa9320309ef">reply</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">  <span class="comment">// {&quot;cols&quot;:[&quot;name&quot;,&quot;port&quot;],&quot;col_types&quot;:[4,9],</span></div><div class="line">  <span class="comment">//  &quot;rows&quot;:[[&quot;Ebenstein&quot;,4200]],&quot;rowcount&quot;:1,&quot;duration&quot;:...}</span></div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="cce_sql-singleconv"></a>
Let CppCrate do the JSON parsing</h2>
<div class="fragment"><div class="line"><a class="code" href="classCppCrate_1_1Result.html" title="Encapsulates Crate&#39;s HTTP endpoint reply enriched by convenience functions for browsing thought the r...">CppCrate::Result</a> result = client.<a class="code" href="classCppCrate_1_1Client.html#a4844c4a9357bd66ce0b0dba7a4853a6f">exec</a>(<span class="stringliteral">&quot;SELECT name, port[&#39;http&#39;] AS port FROM sys.nodes&quot;</span>);</div><div class="line"><span class="keywordflow">if</span> (result &amp;&amp; result.<a class="code" href="classCppCrate_1_1Result.html#a86a8b61d8bab3fedad52ffb9faf36007">recordSize</a>() &gt; 0) {</div><div class="line">  <a class="code" href="classCppCrate_1_1Record.html" title="Encapsulates the values of a single row inside a result. ">CppCrate::Record</a> record = result.<a class="code" href="classCppCrate_1_1Result.html#a886a5eed2a4c44438f1cd24f86988290">record</a>(0);</div><div class="line">  std::cout &lt;&lt; record.<a class="code" href="classCppCrate_1_1Record.html#a81330ef3844ebed9745c4297828bcb59">value</a>(0).<a class="code" href="classCppCrate_1_1Value.html#a33d559d543f7e3bef9eb3f2bfffea469">asString</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;   <span class="comment">// index based access : Ebenstein</span></div><div class="line">  std::cout &lt;&lt; record.<a class="code" href="classCppCrate_1_1Record.html#a81330ef3844ebed9745c4297828bcb59">value</a>(<span class="stringliteral">&quot;port&quot;</span>).asInt() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>; <span class="comment">// name based access  : 4200</span></div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="cce_sql-raw2conv"></a>
Wait, give me JSON and then, maybe, parse it...</h2>
<div class="fragment"><div class="line"><a class="code" href="classCppCrate_1_1RawResult.html" title="Encapsulates Crate&#39;s HTTP endpoint reply. ">CppCrate::RawResult</a> raw = client.<a class="code" href="classCppCrate_1_1Client.html#ac584f633296568452409a7217478f4d0">execRaw</a>(<span class="stringliteral">&quot;SELECT name, port[&#39;http&#39;] AS port FROM sys.nodes&quot;</span>);</div><div class="line"><a class="code" href="classCppCrate_1_1Result.html" title="Encapsulates Crate&#39;s HTTP endpoint reply enriched by convenience functions for browsing thought the r...">CppCrate::Result</a> result(raw);</div></div><!-- fragment --><h2><a class="anchor" id="cce_sql-browse"></a>
Browse through a result set</h2>
<div class="fragment"><div class="line"><a class="code" href="classCppCrate_1_1Result.html" title="Encapsulates Crate&#39;s HTTP endpoint reply enriched by convenience functions for browsing thought the r...">CppCrate::Result</a> result = client.<a class="code" href="classCppCrate_1_1Client.html#a4844c4a9357bd66ce0b0dba7a4853a6f">exec</a>(<span class="stringliteral">&quot;SELECT name, port[&#39;http&#39;] AS port FROM sys.nodes&quot;</span>);</div><div class="line"><span class="keywordflow">if</span> (result) {</div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0, total = result.<a class="code" href="classCppCrate_1_1Result.html#a86a8b61d8bab3fedad52ffb9faf36007">recordSize</a>(); i &lt; total; ++i) {</div><div class="line">    <a class="code" href="classCppCrate_1_1Record.html" title="Encapsulates the values of a single row inside a result. ">CppCrate::Record</a> record = result.<a class="code" href="classCppCrate_1_1Result.html#a886a5eed2a4c44438f1cd24f86988290">record</a>(i);</div><div class="line">    std::cout &lt;&lt; record.<a class="code" href="classCppCrate_1_1Record.html#a81330ef3844ebed9745c4297828bcb59">value</a>(0).<a class="code" href="classCppCrate_1_1Value.html#a33d559d543f7e3bef9eb3f2bfffea469">asString</a>() &lt;&lt; <span class="stringliteral">&quot; -- &quot;</span> &lt;&lt; record.<a class="code" href="classCppCrate_1_1Record.html#a81330ef3844ebed9745c4297828bcb59">value</a>(1).asInt() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="cce_sql-lazyschema"></a>
Don't be verbose, use a default schema</h2>
<div class="fragment"><div class="line">client.<a class="code" href="classCppCrate_1_1Client.html#ac2bf499423bff6e2a01e719eef58d2c5">setDefaultSchema</a>(<span class="stringliteral">&quot;sys&quot;</span>);</div><div class="line"><a class="code" href="classCppCrate_1_1Result.html" title="Encapsulates Crate&#39;s HTTP endpoint reply enriched by convenience functions for browsing thought the r...">CppCrate::Result</a> result = client.<a class="code" href="classCppCrate_1_1Client.html#a4844c4a9357bd66ce0b0dba7a4853a6f">exec</a>(<span class="stringliteral">&quot;SELECT name FROM nodes&quot;</span>);</div><div class="line"><span class="comment">// Automatically queries from the table &quot;sys.nodes&quot;</span></div></div><!-- fragment --><h2><a class="anchor" id="cce_sql-prepare"></a>
Prepare queries and reuse them (parameter substitution)</h2>
<div class="fragment"><div class="line"><a class="code" href="classCppCrate_1_1Query.html" title="Provides the possibility to define SQL statements covering also parameter substitution and bulk opera...">CppCrate::Query</a> query(<span class="stringliteral">&quot;SELECT age FROM players WHERE name = ?&quot;</span>);</div><div class="line"><span class="comment">// Query the age of Calvin</span></div><div class="line">query.setArguments(<span class="stringliteral">&quot;[\&quot;Calvin\&quot;]&quot;</span>);</div><div class="line">client.<a class="code" href="classCppCrate_1_1Client.html#a4844c4a9357bd66ce0b0dba7a4853a6f">exec</a>(query);</div><div class="line"><span class="comment">// Query the age of Hobbes</span></div><div class="line">query.setArguments(<span class="stringliteral">&quot;[\&quot;Hobbes\&quot;]&quot;</span>);</div><div class="line">client.<a class="code" href="classCppCrate_1_1Client.html#a4844c4a9357bd66ce0b0dba7a4853a6f">exec</a>(query);</div></div><!-- fragment --><h2><a class="anchor" id="cce_sql-bulk"></a>
Bulk operation</h2>
<div class="fragment"><div class="line"><a class="code" href="classCppCrate_1_1Query.html" title="Provides the possibility to define SQL statements covering also parameter substitution and bulk opera...">CppCrate::Query</a> query(<span class="stringliteral">&quot;UPDATE players SET age = 8 WHERE name = ?&quot;</span>);</div><div class="line">std::vector&lt;std::string&gt; bulk;</div><div class="line">bulk.emplace_back(<span class="stringliteral">&quot;[\&quot;Calvin\&quot;]&quot;</span>);</div><div class="line">bulk.emplace_back(<span class="stringliteral">&quot;[\&quot;Hobbes\&quot;]&quot;</span>);</div><div class="line">query.setBulkArguments(bulk);</div><div class="line"><a class="code" href="classCppCrate_1_1RawResult.html" title="Encapsulates Crate&#39;s HTTP endpoint reply. ">CppCrate::RawResult</a> result = client.<a class="code" href="classCppCrate_1_1Client.html#ac584f633296568452409a7217478f4d0">execRaw</a>(query);</div><div class="line"><span class="keywordflow">if</span> (!result.<a class="code" href="classCppCrate_1_1RawResult.html#af701ce9676ec0df572433c4ef4af1c66">hasError</a>()) {</div><div class="line">  <span class="comment">// all rows updated.</span></div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="cce_sql-hurry"></a>
I'm in a hurry: change and get the results back immediately</h2>
<div class="fragment"><div class="line">client.<a class="code" href="classCppCrate_1_1Client.html#ac584f633296568452409a7217478f4d0">execRaw</a>(<span class="stringliteral">&quot;UPDATE players SET age = 42&quot;</span>);</div><div class="line">client.<a class="code" href="classCppCrate_1_1Client.html#af67b6305716da2ebedae737701e9ed91">refresh</a>();  <span class="comment">// Forces Crate to refresh it&#39;s tables.</span></div><div class="line">client.<a class="code" href="classCppCrate_1_1Client.html#ac584f633296568452409a7217478f4d0">execRaw</a>(<span class="stringliteral">&quot;SELECT * FROM players&quot;</span>);</div></div><!-- fragment --><h1><a class="anchor" id="cppcrateexamples_blob"></a>
Blob Interface</h1>
<h2><a class="anchor" id="cce_blob-create"></a>
Create a new blob table</h2>
<div class="fragment"><div class="line">client.<a class="code" href="classCppCrate_1_1Client.html#a044097ddfd383a676ecaeafa2ea817a3">createBlobStorage</a>(<span class="stringliteral">&quot;myblob&quot;</span>);</div></div><!-- fragment --><h2><a class="anchor" id="cce_blob-create2"></a>
Create a new blob table and store it at /fs/myblob</h2>
<div class="fragment"><div class="line">client.<a class="code" href="classCppCrate_1_1Client.html#a044097ddfd383a676ecaeafa2ea817a3">createBlobStorage</a>(<span class="stringliteral">&quot;myblob&quot;</span>, <span class="stringliteral">&quot;/fs/myblob&quot;</span>);</div></div><!-- fragment --><h2><a class="anchor" id="cce_blob-upload"></a>
Upload an image</h2>
<div class="fragment"><div class="line">std::ifstream image;</div><div class="line">image.open(<span class="stringliteral">&quot;/path/to/image&quot;</span>, std::ifstream::in | std::ifstream::binary);</div><div class="line"><span class="keywordflow">if</span> (image) {</div><div class="line">  <a class="code" href="classCppCrate_1_1BlobResult.html" title="Encapsulates Crate&#39;s HTTP endpoint reply of a blob operation. ">CppCrate::BlobResult</a> result = client.<a class="code" href="classCppCrate_1_1Client.html#a688394f070cc0c63b1d79cac999b8501">uploadBlob</a>(<span class="stringliteral">&quot;myblob&quot;</span>, image);</div><div class="line">  <span class="keywordflow">if</span> (result) {</div><div class="line">    <span class="comment">// result.key() returns the key for the uploaded image,</span></div><div class="line">    <span class="comment">// for example 93390aa9ed64e1e96149ceb0262f34aa2aedcffc</span></div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="cce_blob-exists"></a>
Check if an image exists</h2>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (client.<a class="code" href="classCppCrate_1_1Client.html#af6710b9e2a841542f505d1bcd5395b75">existsBlob</a>(<span class="stringliteral">&quot;myblob&quot;</span>, <span class="stringliteral">&quot;93390aa9ed64e1e96149ceb0262f34aa2aedcffc&quot;</span>)) {</div><div class="line">  <span class="comment">// Yeah!</span></div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="cce_blob-down"></a>
Now, get me the image back</h2>
<div class="fragment"><div class="line">std::ofstream image;</div><div class="line">image.open(<span class="stringliteral">&quot;/path/where/to/download/the/image&quot;</span>, std::ifstream::out | std::ifstream::binary);</div><div class="line"><span class="keywordflow">if</span> (image) {</div><div class="line">  client.<a class="code" href="classCppCrate_1_1Client.html#ad2e1a3427178d67b42f038c8be8a7761">downloadBlob</a>(<span class="stringliteral">&quot;myblob&quot;</span>, <span class="stringliteral">&quot;93390aa9ed64e1e96149ceb0262f34aa2aedcffc&quot;</span>, image);</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="cce_blob-del"></a>
The image is mine, delete it</h2>
<div class="fragment"><div class="line">client.<a class="code" href="classCppCrate_1_1Client.html#a693cd2f5528e950c89bff33c2c2e913b">deleteBlob</a>(<span class="stringliteral">&quot;myblob&quot;</span>, <span class="stringliteral">&quot;93390aa9ed64e1e96149ceb0262f34aa2aedcffc&quot;</span>);</div></div><!-- fragment --><h2><a class="anchor" id="cce_blob-delTable"></a>
I have enough, delete the entire blob table</h2>
<div class="fragment"><div class="line">client.<a class="code" href="classCppCrate_1_1Client.html#a923069801516e3d986052a65d90ca425">removeBlobStorage</a>(<span class="stringliteral">&quot;myblob&quot;</span>);</div></div><!-- fragment --> </div></div><!-- contents -->
<div id="footer">CppCrate&ensp;v.&#8202;0.1&emsp;&#x2E3A;&emsp;Copyright 2017 Lorenz Haas</div></body></html>
